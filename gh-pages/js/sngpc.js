const API_BASE = '/api';
async function loadSngpc(){ try{ const q=document.getElementById('searchSngpc').value; const res=await axios.get(`${API_BASE}/sngpc?search=${encodeURIComponent(q)}`); const items=res.data.data||res.data||[]; const c=document.getElementById('sngpcList'); if(!items.length){ c.innerHTML=`<div class="text-center py-5 text-muted"><i class="fa fa-folder-open fa-4x"></i><p>Nenhuma credencial cadastrada</p></div>`; return;} c.innerHTML=items.map(it=>`<div class="card list-card"><div class="card-body d-flex justify-content-between align-items-center"><div><div class="font-weight-bold">${it.usuario||it.user||''}</div><div class="text-muted">CNPJ: ${it.cnpj_farmacia||'-'} â€¢ CRF: ${it.crf||'-'}</div></div><div class="btn-group"><button class="btn btn-sm btn-outline-primary" onclick="editSngpc('${it.id}')"><i class="fa fa-edit"></i></button><button class="btn btn-sm btn-outline-danger" onclick="deleteSngpc('${it.id}')"><i class="fa fa-trash"></i></button></div></div></div>`).join(''); }catch(e){console.error(e); document.getElementById('sngpcList').innerHTML='<div class="alert alert-warning">Erro ao carregar.</div>';} }
function openSngpcModal(item=null){ document.getElementById('sngpcForm').reset(); document.getElementById('sngpcId').value=''; document.getElementById('sngpcModalTitle').textContent='Nova Credencial SNGPC'; if(item){ document.getElementById('sngpcId').value=item.id; document.getElementById('sngpcUser').value=item.usuario||item.user||''; document.getElementById('sngpcPass').value=item.senha||item.pass||''; document.getElementById('sngpcModalTitle').textContent='Editar Credencial SNGPC'; } $('#sngpcModal').modal('show'); }
async function editSngpc(id){ try{ const res=await axios.get(`${API_BASE}/sngpc/${id}`); openSngpcModal(res.data); }catch(e){alert('Erro ao obter');} }
async function saveSngpc(){ const id=document.getElementById('sngpcId').value; const data={ user:document.getElementById('sngpcUser').value, pass:document.getElementById('sngpcPass').value }; try{ if(id) await axios.put(`${API_BASE}/sngpc/${id}`, data); else await axios.post(`${API_BASE}/sngpc`, data); $('#sngpcModal').modal('hide'); loadSngpc(); }catch(e){alert('Erro ao salvar');} }
async function deleteSngpc(id){ if(!confirm('Excluir?')) return; try{ await axios.delete(`${API_BASE}/sngpc/${id}`); loadSngpc(); }catch(e){alert('Erro ao excluir');} }

document.addEventListener('DOMContentLoaded', ()=>{ document.getElementById('searchSngpc').addEventListener('input', debounce(loadSngpc,300)); loadSngpc(); }); function debounce(fn,t){ let timer; return (...a)=>{ clearTimeout(timer); timer=setTimeout(()=>fn(...a), t); }; }
